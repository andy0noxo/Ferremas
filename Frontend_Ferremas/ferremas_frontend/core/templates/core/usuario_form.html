{% extends 'base.html' %}
{% block title %}{{ accion }} Usuario{% endblock %}
{% block nav %}
<ul>
    <li><a href="{% url 'core:dashboard' %}">Inicio</a></li>
    <li><a href="{% url 'core:usuarios_list' %}">Usuarios</a></li>
</ul>
{% endblock %}
{% block content %}
<h2>{{ accion }} Usuario</h2>
{% if form.errors %}
    <div class="errorlist">
        <ul>
        {% for field in form %}
            {% for error in field.errors %}
                <li>{{ field.label }}: {{ error }}</li>
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
        {% endfor %}
        </ul>
    </div>
{% endif %}
<form method="post">
    {% csrf_token %}
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" value="{{ form.nombre.value|default:usuario.nombre|default:'' }}" required><br>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" value="{{ form.email.value|default:usuario.email|default:'' }}" required><br>
    <label for="password">Contraseña:</label>
    <input type="password" id="password" name="password" {% if accion == 'Crear' %}required{% endif %}><br>
    <label for="rut">RUT:</label>
    <input type="text" id="rut" name="rut" value="{{ form.rut.value|default:usuario.rut|default:'' }}" required><br>
    <label for="rol_id">Rol:</label>
    <select id="rol_id" name="rol_id" required>
        <option value="">Seleccione</option>
        {% for rol in roles %}
            <option value="{{ rol.id }}" {% if form.rol_id.value|stringformat:'s' == rol.id|stringformat:'s' or usuario.rol.id == rol.id %}selected{% endif %}>{{ rol.nombre }}</option>
        {% endfor %}
    </select><br>
    <label for="sucursal_id">Sucursal:</label>
    <select id="sucursal_id" name="sucursal_id" required>
        <option value="">Seleccione</option>
        {% for sucursal in sucursales %}
            <option value="{{ sucursal.id }}" {% if form.sucursal_id.value|stringformat:'s' == sucursal.id|stringformat:'s' or usuario.sucursal.id == sucursal.id %}selected{% endif %}>{{ sucursal.nombre }}</option>
        {% endfor %}
    </select><br>
    <button type="submit">{{ accion }}</button>
</form>
{% if accion == 'Editar' %}
<form method="post" action="{% url 'core:usuario_eliminar' usuario.id %}" style="margin-top:1em;">
    {% csrf_token %}
    <button type="submit" onclick="return confirm('¿Seguro que desea eliminar este usuario?');">Eliminar</button>
</form>
{% endif %}
<a href="{% url 'core:usuarios_list' %}">Volver al listado</a>
{% endblock %}
